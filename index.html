<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>My First jQuery Powered Web Page</title>
    <link rel="stylesheet" href="css/style.css">
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.4/Chart.js"></script>

</head>
<script type='text/javascript'>
$(document).ready(function(){
    $("form").submit(function(e){
        e.preventDefault(e);

        var initial_amount = Number($("#initial_amount").val());
        var contribution_amount = Number($("#contribution_amount").val());
        var contribution_period = 12 // months
        var interest_amount = Number($("#interest_amount").val());
        var period_in_years = Number($("#years").val());

        var contribution_sum = 0
        var interest_sum = 0
        var final_balances = [];
        var initial_balance = initial_amount;

        for (let i = 1; i <= period_in_years; i++) {
            annual_contribution = contribution_amount * contribution_period;
            contribution_sum = contribution_sum + annual_contribution;
            final_balance = compoundInterest(i, initial_amount, annual_contribution, interest_amount);
            positive_interest = final_balance - initial_balance - annual_contribution;
            interest_sum = interest_sum + positive_interest;

            final_balances.push(final_balance);

            console.log('Balance Inicial: ' + initial_balance);
            console.log('Aportaciones anuales: ' + annual_contribution);
            console.log('Aportaciones acumuladas: ' + contribution_sum);
            console.log('Interés devengado: ' + positive_interest);
            console.log('Interés acumulado: ' + interest_sum);
            console.log('Balance final: ' + final_balance);
            console.log('===='+i+'====');

            initial_balance = final_balance;
        }

        build_chart(period_in_years, final_balances);
        display_final_information(
            initial_amount,
            annual_contribution,
            contribution_sum,
            positive_interest,
            interest_sum,
            final_balance
        )
    });
});

function compoundInterest(t, initial, annual, interest_rate) {
    return initial * (1+interest_rate) ** t + annual * (1+interest_rate) * ((1+interest_rate) ** t - 1) / interest_rate;
};

function build_chart(period_in_years, final_balances) {
    // Create label names
    const label_names = [];
    for (let i = 1; i <= period_in_years; i++) {
      label_names.push("Año " + i);
    }

    // Create data
    const data = {
        labels: label_names,
        datasets: [{
            label: 'Rendimientos Anuales',
            data: final_balances,
            borderWidth: 2,
            borderSkipped: false,
        }]
    };

    // Create config
    const config = {
        type: 'bar',
        data: data,
        options: {
            responsive: true,
            plugins: {
                legend: {
                    position: 'top',
                },
            }
        }
    };

    // Remove objects from DOM
    $("#chart_zone").empty();
    $('#chart_zone').append('<canvas id="myChart" style="width:100%;max-width:700px"></canvas>');

    // Display new chart
    const ctx = document.getElementById('myChart');
    const myChart = new Chart(
        ctx,
        config
    );
}

function display_final_information(initial_amount, annual_contribution, contribution_sum, positive_interest, interest_sum, final_balance){

    var formatter = new Intl.NumberFormat('es-CO', {style: 'currency',currency: 'COP',maximumFractionDigits: 1});
    formatter.format(2500);

    initial_amount = formatter.format(initial_amount);
    annual_contribution = formatter.format(annual_contribution);
    contribution_sum = formatter.format(contribution_sum);
    positive_interest = formatter.format(positive_interest);
    interest_sum = formatter.format(interest_sum);
    final_balance = formatter.format(final_balance);

    $('#chart_zone').append('<ul id="facts"></ul>');

    $('#facts').append('<li>El balance inicial fue de ' + initial_amount + '</li>');
    $('#facts').append('<li>Las contribuciones anuales fueron de ' + annual_contribution + '</li>');
    $('#facts').append('<li>La suma de las contribuciones fue de ' + contribution_sum + '</li>');
    $('#facts').append('<li>El interés fue de ' + positive_interest + ' </li>');
    $('#facts').append('<li>La suma del interés fue de ' + interest_sum + '</li>');
    $('#facts').append('<li>El balance final fue de ' + final_balance + '</li>');

}


</script>
<body>
<h1>Hello, World!</h1>

<form>
    <h2>Paso 1: Estado inicial</h2><br>
    <label>Cantidad inicial:</label><br>
    <p>Escribe el monto inicial con el que comenzarás la inversión, por ejemplo, $500.000.</p>
    <input type="text" id="initial_amount" value="500000"><br>

    <h2>Paso 2: Aportes</h2><br>
    <label>Valor del aporte</label><br>
    <p>Escribe el monto mensual que depositarás, por ejemplo, $200.000</p>
    <input type="text" id="contribution_amount" value="200000"><br>

    <h2>Paso 3: Intereses</h2><br>
    <label>Valor del interés</label><br>
    <p>Escribe el interés anual que tu dinero rendirá, por ejemplo, 0.05</p>
    <input type="text" id="interest_amount" value="0.05"><br>

    <h2>Paso 4: Duración</h2><br>
    <label>Número de años</label><br>
    <p>Escribe número de años por el cual realizarás los aportes</p>
    <input type="text" id="years" value="5"><br>

    <input id="send" type="submit" value="Submit">
</form>

<div id="chart_zone">
    <canvas id="myChart" style="width:100%;max-width:700px"></canvas>
</div>


<h1 style="display: none;">Agradecimientos</h1>
<ul style="display: none;">
    <li>https://www.tutorialrepublic.com/jquery-tutorial/jquery-getter-and-setter.php</li>
    <li>https://a2-finance.com/es/calculators/todas-las-calculadoras/calculadora-de-interes-compuesto</li>
    <li>https://www.tutorialspoint.com/calculate-compound-interest-in-javascript</li>
    <li>https://stackoverflow.com/questions/21543017/compound-interest-with-deposits-in-python</li>
</ul>

</body>
</html>
